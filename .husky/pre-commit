#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check for secrets in staged files
echo "ğŸ”’ Checking for secrets..."
if git diff --cached --name-only | xargs grep -l "PRIVATE_KEY\|SECRET\|API_KEY" 2>/dev/null; then
  echo "âŒ Warning: Possible secrets detected in staged files!"
  echo "Please review and remove any sensitive data before committing."
fi

# Lint Solidity files
echo "ğŸ”§ Linting Solidity files..."
npm run lint:solidity || {
  echo "âŒ Solidity linting failed. Please fix errors before committing."
  exit 1
}

# Format check
echo "âœ¨ Checking code formatting..."
npm run format:check || {
  echo "âŒ Code formatting check failed. Run 'npm run format' to fix."
  exit 1
}

# Type check
echo "ğŸ“ Running TypeScript type check..."
npm run type-check || {
  echo "âŒ TypeScript type check failed. Please fix type errors."
  exit 1
}

# Lint JavaScript/TypeScript
echo "ğŸ” Linting JavaScript/TypeScript..."
npm run lint || {
  echo "âŒ ESLint failed. Please fix linting errors."
  exit 1
}

echo "âœ… All pre-commit checks passed!"
